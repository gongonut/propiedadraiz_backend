import{b as T,c as f,d as k,e as N,g as V,j as M,l as q,q as A,s as G}from"./chunk-VIDUQQKM.js";import{a as D}from"./chunk-CABCZIUH.js";import{a as U}from"./chunk-OGU4BQWJ.js";import"./chunk-FBTTXVKJ.js";import"./chunk-JXAVADQN.js";import{$ as h,Ab as w,Bb as p,Hb as C,Jb as l,Kb as E,Pa as n,cb as P,cc as F,fa as _,ga as v,hb as c,qb as s,rb as o,sb as i,tb as m,tc as S,wc as I,zb as y}from"./chunk-O5M3UDUQ.js";function O(e,r){e&1&&(o(0,"div",7),l(1,"Cargando..."),i())}function j(e,r){if(e&1&&(o(0,"div",8),l(1),i()),e&2){let t=p();n(),E(t.error)}}function R(e,r){if(e&1&&(o(0,"div",9),l(1),i()),e&2){let t=p();n(),E(t.successMessage)}}function W(e,r){e&1&&(o(0,"p",28),l(1," El nombre es requerido. "),i())}function B(e,r){e&1&&(o(0,"p",28),l(1," El tel\xE9fono es requerido. "),i())}function H(e,r){e&1&&(o(0,"p",28),l(1," El n\xFAmero de WhatsApp es requerido. "),i())}function J(e,r){if(e&1){let t=y();o(0,"button",29),w("click",function(){_(t);let u=p(2);return v(u.toggleEdit())}),l(1," Editar Perfil "),i()}}function K(e,r){if(e&1&&(o(0,"button",30),l(1," Guardar Cambios "),i()),e&2){let t=p(2);s("disabled",t.profileForm.invalid||t.loading)}}function L(e,r){if(e&1){let t=y();o(0,"button",31),w("click",function(){_(t);let u=p(2);return v(u.onCancel())}),l(1," Cancelar "),i()}}function Q(e,r){if(e&1){let t=y();o(0,"div",10)(1,"form",11),w("ngSubmit",function(){_(t);let u=p();return v(u.onSave())}),o(2,"div",12)(3,"div")(4,"label",13),l(5,"Nombre:"),i(),m(6,"input",14),c(7,W,2,0,"p",15),i(),o(8,"div")(9,"label",16),l(10,"Empresa:"),i(),m(11,"input",17),i(),o(12,"div")(13,"label",18),l(14,"Correo Electr\xF3nico:"),i(),m(15,"input",19),i(),o(16,"div")(17,"label",20),l(18,"Tel\xE9fono:"),i(),m(19,"input",21),c(20,B,2,0,"p",15),i(),o(21,"div")(22,"label",22),l(23,"WhatsApp:"),i(),m(24,"input",23),c(25,H,2,0,"p",15),i()(),o(26,"div",24),c(27,J,2,0,"button",25)(28,K,2,1,"button",26)(29,L,2,0,"button",27),i()()()}if(e&2){let t,d,u,g,b,x,a=p();n(),s("formGroup",a.profileForm),n(5),C("border-red-500",((t=a.profileForm.get("nombre"))==null?null:t.invalid)&&((t=a.profileForm.get("nombre"))==null?null:t.touched)),n(),s("ngIf",((d=a.profileForm.get("nombre"))==null?null:d.invalid)&&((d=a.profileForm.get("nombre"))==null?null:d.touched)),n(12),C("border-red-500",((u=a.profileForm.get("telefono"))==null?null:u.invalid)&&((u=a.profileForm.get("telefono"))==null?null:u.touched)),n(),s("ngIf",((g=a.profileForm.get("telefono"))==null?null:g.invalid)&&((g=a.profileForm.get("telefono"))==null?null:g.touched)),n(4),C("border-red-500",((b=a.profileForm.get("whatsapp"))==null?null:b.invalid)&&((b=a.profileForm.get("whatsapp"))==null?null:b.touched)),n(),s("ngIf",((x=a.profileForm.get("whatsapp"))==null?null:x.invalid)&&((x=a.profileForm.get("whatsapp"))==null?null:x.touched)),n(2),s("ngIf",!a.isEditing),n(),s("ngIf",a.isEditing),n(),s("ngIf",a.isEditing)}}function X(e,r){e&1&&(o(0,"div",32)(1,"p"),l(2,"Cargando informaci\xF3n del usuario o no hay usuario autenticado."),i()())}var z=class e{authService=h(U);userService=h(D);fb=h(A);currentUser=null;profileForm;isEditing=!1;loading=!1;error=null;successMessage=null;constructor(){F(()=>{let r=this.authService.currentUser();r&&(this.currentUser=r,this.initForm())})}ngOnInit(){}initForm(){this.profileForm=this.fb.group({empresa:[this.currentUser?.empresa,[]],nombre:[this.currentUser?.nombre,f.required],telefono:[this.currentUser?.telefono,f.required],whatsapp:[this.currentUser?.whatsapp,f.required],correo:[{value:this.currentUser?.correo,disabled:!0},[f.required,f.email]]})}toggleEdit(){this.isEditing=!this.isEditing,this.isEditing?(this.profileForm.enable(),this.profileForm.get("correo")?.disable()):this.profileForm.disable(),this.error=null,this.successMessage=null}onSave(){if(this.profileForm.invalid||!this.currentUser?._id){this.profileForm.markAllAsTouched();return}this.loading=!0,this.error=null,this.successMessage=null;let r=this.profileForm.getRawValue();this.userService.updateUserProfile(this.currentUser._id,r).subscribe({next:t=>{this.authService.updateUser(t),this.successMessage="Perfil actualizado exitosamente.",this.isEditing=!1,this.profileForm.disable(),this.loading=!1},error:t=>{console.error("Error al actualizar el perfil:",t),this.error="Error al actualizar el perfil. Int\xE9ntalo de nuevo.",this.loading=!1}})}onCancel(){this.isEditing=!1,this.initForm(),this.profileForm.disable(),this.error=null,this.successMessage=null}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=P({type:e,selectors:[["app-profile-page"]],decls:8,vars:5,consts:[[1,"container","mx-auto","p-4"],[1,"text-2xl","font-bold","mb-4"],["class","text-center text-blue-500",4,"ngIf"],["class","text-center text-red-500",4,"ngIf"],["class","text-center text-green-500",4,"ngIf"],["class","bg-white shadow-md rounded-lg p-6",4,"ngIf"],["class","bg-white shadow-md rounded-lg p-6 text-center text-gray-600",4,"ngIf"],[1,"text-center","text-blue-500"],[1,"text-center","text-red-500"],[1,"text-center","text-green-500"],[1,"bg-white","shadow-md","rounded-lg","p-6"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","nombre",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","text","id","nombre","formControlName","nombre",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["class","text-red-500 text-xs italic",4,"ngIf"],["for","empresa",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","text","id","empresa","formControlName","empresa",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","correo",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","email","id","correo","formControlName","correo","readonly","",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline","bg-gray-100"],["for","telefono",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","text","id","telefono","formControlName","telefono",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","whatsapp",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["type","text","id","whatsapp","formControlName","whatsapp",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],[1,"mt-6","flex","justify-end","space-x-4"],["type","button","class","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",3,"click",4,"ngIf"],["type","submit","class","bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",3,"disabled",4,"ngIf"],["type","button","class","bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",3,"click",4,"ngIf"],[1,"text-red-500","text-xs","italic"],["type","button",1,"bg-blue-500","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],["type","submit",1,"bg-green-500","hover:bg-green-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline","disabled:opacity-50",3,"disabled"],["type","button",1,"bg-gray-500","hover:bg-gray-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"],[1,"bg-white","shadow-md","rounded-lg","p-6","text-center","text-gray-600"]],template:function(t,d){t&1&&(o(0,"div",0)(1,"h2",1),l(2,"Perfil de Usuario"),i(),c(3,O,2,0,"div",2)(4,j,2,1,"div",3)(5,R,2,1,"div",4)(6,Q,30,13,"div",5)(7,X,3,0,"div",6),i()),t&2&&(n(3),s("ngIf",d.loading),n(),s("ngIf",d.error),n(),s("ngIf",d.successMessage),n(),s("ngIf",d.currentUser),n(),s("ngIf",!d.currentUser))},dependencies:[I,S,G,V,T,k,N,M,q],encapsulation:2})};export{z as ProfilePageComponent};
