import{b as k,c as i,d as D,e as M,g as G,h as R,i as j,j as L,l as U,m as z,n as W,o as B,q as $,s as H}from"./chunk-VIDUQQKM.js";import{a as J}from"./chunk-CABCZIUH.js";import"./chunk-OGU4BQWJ.js";import"./chunk-FBTTXVKJ.js";import{g as O,i as q}from"./chunk-JXAVADQN.js";import{$ as b,Ab as g,Bb as c,Jb as n,Kb as h,Lb as v,Nb as F,Pa as m,Wb as P,Xb as N,a as C,b as w,cb as _,fa as f,ga as x,hb as u,qb as p,rb as r,sb as e,sc as V,tb as d,tc as A,vc as I,wc as T,xb as E,yb as S,zb as y}from"./chunk-O5M3UDUQ.js";function X(a,o){a&1&&(r(0,"div",33),n(1," Nombre de empresa es requerido. "),e())}function Y(a,o){a&1&&(r(0,"div",33),n(1," NIT es requerido. "),e())}function Z(a,o){if(a&1&&(r(0,"div",27)(1,"div")(2,"label",28),n(3,"Nombre Empresa"),e(),d(4,"input",29),u(5,X,2,0,"div",30),e(),r(6,"div")(7,"label",31),n(8,"NIT"),e(),d(9,"input",32),u(10,Y,2,0,"div",30),e()()),a&2){let t,l,s=c();m(5),p("ngIf",((t=s.onboardingForm.get("empresa"))==null?null:t.invalid)&&((t=s.onboardingForm.get("empresa"))==null?null:t.touched)),m(5),p("ngIf",((l=s.onboardingForm.get("nit"))==null?null:l.invalid)&&((l=s.onboardingForm.get("nit"))==null?null:l.touched))}}function ee(a,o){a&1&&(r(0,"span",34),n(1,"(Dejar en blanco para mantener actual)"),e())}function te(a,o){if(a&1){let t=y();r(0,"li",42)(1,"div",43)(2,"span",44),n(3),e(),r(4,"span",45),n(5),P(6,"number"),e()(),r(7,"div",46)(8,"button",47),g("click",function(){let s=f(t).index,Q=c(3);return x(Q.removeProperty(s))}),n(9,"Eliminar"),e()()()}if(a&2){let t=o.$implicit;m(3),h(t.nombreEdificio||"Propiedad sin nombre"),m(2),F("",t.direccion," - ",t.ciudad," ($",N(6,4,t.precio),")")}}function re(a,o){if(a&1&&(r(0,"div",39)(1,"ul",40),u(2,te,10,6,"li",41),e()()),a&2){let t=c(2);m(2),p("ngForOf",t.propertiesList)}}function ne(a,o){if(a&1){let t=y();r(0,"div",48)(1,"h4",49),n(2,"Nueva Propiedad"),e(),r(3,"div",50)(4,"div",51)(5,"label",52),n(6,"Tipo Transacci\xF3n"),e(),r(7,"select",53)(8,"option",54),n(9,"Venta"),e(),r(10,"option",55),n(11,"Alquiler"),e(),r(12,"option",56),n(13,"Ambos"),e()()(),r(14,"div",57)(15,"label",52),n(16,"Nombre Edificio / Conjunto"),e(),d(17,"input",58),e()(),r(18,"div",12)(19,"div")(20,"label",52),n(21,"Direcci\xF3n"),e(),d(22,"input",59),e(),r(23,"div")(24,"label",52),n(25,"Ciudad"),e(),d(26,"input",60),e(),r(27,"div")(28,"label",52),n(29,"Departamento"),e(),d(30,"input",61),e(),r(31,"div")(32,"label",52),n(33,"Precio"),e(),d(34,"input",62),e()(),r(35,"div",4)(36,"label",52),n(37,"Descripci\xF3n"),e(),d(38,"textarea",63),e(),r(39,"div",64)(40,"div")(41,"label",52),n(42,"\xC1rea (m2)"),e(),d(43,"input",65),e(),r(44,"div")(45,"label",52),n(46,"Habitaciones"),e(),d(47,"input",66),e(),r(48,"div")(49,"label",52),n(50,"Ba\xF1os"),e(),d(51,"input",67),e(),r(52,"div")(53,"label",52),n(54,"Garajes"),e(),d(55,"input",68),e()(),r(56,"div",69)(57,"div")(58,"label",52),n(59,"Latitud (Demo)"),e(),d(60,"input",70),e(),r(61,"div")(62,"label",52),n(63,"Longitud (Demo)"),e(),d(64,"input",71),e()(),r(65,"div",72)(66,"button",73),g("click",function(){f(t);let s=c(2);return x(s.addProperty())}),n(67," Guardar Propiedad "),e()()()}if(a&2){let t=c(2);p("formGroup",t.propertyForm)}}function oe(a,o){if(a&1){let t=y();E(0),r(1,"h3",35)(2,"span"),n(3,"Cartera de Propiedades"),e(),r(4,"button",36),g("click",function(){f(t);let s=c();return x(s.togglePropertyForm())}),n(5),e()(),u(6,re,3,1,"div",37)(7,ne,68,1,"div",38),S()}if(a&2){let t=c();m(5),v(" ",t.showPropertyForm?"Cancelar":"+ Agregar Propiedad"," "),m(),p("ngIf",t.propertiesList.length>0),m(),p("ngIf",t.showPropertyForm)}}var K=class a{fb=b($);userService=b(J);router=b(q);route=b(O);onboardingForm;propertyForm;propertiesList=[];showPropertyForm=!1;isEditMode=!1;userId=null;constructor(){this.onboardingForm=this.fb.group({tipoPersona:["NATURAL",i.required],nit:[""],empresa:[""],nombre:["",i.required],telefono:["",i.required],whatsapp:["",i.required],correo:["",[i.required,i.email]],password:["",[i.required,i.minLength(8)]]}),this.propertyForm=this.createPropertyForm(),this.onboardingForm.get("tipoPersona")?.valueChanges.subscribe(o=>{this.updateValidators(o)})}ngOnInit(){let o=this.route.snapshot.paramMap.get("id");o&&(this.isEditMode=!0,this.userId=o,this.loadUser(o))}loadUser(o){this.userService.getUserProfile(o).subscribe({next:t=>{this.onboardingForm.patchValue({tipoPersona:t.tipoPersona||"NATURAL",nit:t.nit,empresa:t.empresa,nombre:t.nombre,telefono:t.telefono,whatsapp:t.whatsapp,correo:t.correo}),this.updateValidators(t.tipoPersona||"NATURAL");let l=this.onboardingForm.get("password");l?.clearValidators(),l?.updateValueAndValidity()},error:t=>{console.error("Error loading user",t),alert("Error al cargar datos del usuario"),this.router.navigate(["/users"])}})}createPropertyForm(){return this.fb.group({code:[""],nombreEdificio:[""],direccion:["",i.required],ciudad:["",i.required],departamento:["",i.required],descripcion:["",i.required],tipoTransaccion:["Venta",i.required],precio:[0,[i.required,i.min(1)]],area:[0,[i.required,i.min(1)]],habitaciones:[0,[i.required,i.min(0)]],banos:[0,[i.required,i.min(0)]],garajes:[0],piso:[0],lat:[0,i.required],lon:[0,i.required]})}updateValidators(o){let t=this.onboardingForm.get("nit"),l=this.onboardingForm.get("empresa");o==="EMPRESA"?(t?.setValidators([i.required]),l?.setValidators([i.required])):(t?.clearValidators(),l?.clearValidators()),t?.updateValueAndValidity(),l?.updateValueAndValidity()}togglePropertyForm(){this.showPropertyForm=!this.showPropertyForm,this.showPropertyForm&&this.propertyForm.reset({tipoTransaccion:"Venta",precio:0,area:0,habitaciones:0,banos:0,garajes:0,piso:0,lat:0,lon:0})}addProperty(){if(this.propertyForm.invalid){this.propertyForm.markAllAsTouched();return}let o=this.propertyForm.value,t=w(C({},o),{geolocalizacion:{lat:o.lat,lon:o.lon}});delete t.lat,delete t.lon,this.propertiesList.push(t),this.togglePropertyForm()}removeProperty(o){this.propertiesList.splice(o,1)}submitOnboarding(){if(this.onboardingForm.invalid){this.onboardingForm.markAllAsTouched();return}if(this.isEditMode&&this.userId){let o=this.onboardingForm.value;o.password||delete o.password,this.userService.updateUserProfile(this.userId,o).subscribe({next:t=>{console.log("Usuario actualizado",t),alert("Usuario actualizado exitosamente"),this.router.navigate(["/users"])},error:t=>{console.error("Error actualizando usuario",t),alert("Error actualizando usuario: "+(t.error?.message||t.message))}})}else{let o={userData:this.onboardingForm.value,properties:this.propertiesList};this.userService.createWithProperties(o).subscribe({next:t=>{console.log("Cliente registrado con \xE9xito",t),alert("Cliente y propiedades registrados exitosamente"),this.router.navigate(["/"])},error:t=>{console.error("Error al registrar cliente",t),alert("Error al registrar cliente: "+(t.error?.message||t.message))}})}}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=_({type:a,selectors:[["app-client-onboarding"]],decls:45,vars:6,consts:[[1,"container","mx-auto","p-6","max-w-4xl"],[1,"text-3xl","font-bold","mb-6","text-gray-800"],[1,"bg-white","shadow-md","rounded","px-8","pt-6","pb-8","mb-4",3,"ngSubmit","formGroup"],[1,"text-xl","font-semibold","mb-4","text-gray-700","border-b","pb-2"],[1,"mb-4"],[1,"block","text-gray-700","text-sm","font-bold","mb-2"],[1,"flex","items-center","space-x-4"],[1,"inline-flex","items-center"],["type","radio","formControlName","tipoPersona","value","NATURAL",1,"form-radio","text-blue-600"],[1,"ml-2"],["type","radio","formControlName","tipoPersona","value","EMPRESA",1,"form-radio","text-blue-600"],["class","grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 bg-gray-50 p-4 rounded",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["for","nombre",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","nombre","type","text","formControlName","nombre",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","correo",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","correo","type","email","formControlName","correo",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","telefono",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","telefono","type","text","formControlName","telefono",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","whatsapp",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","whatsapp","type","text","formControlName","whatsapp",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["for","password",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["class","text-gray-400 font-normal text-xs",4,"ngIf"],["id","password","type","password","formControlName","password",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],[4,"ngIf"],[1,"flex","items-center","justify-between","mt-8"],["type","submit",1,"bg-blue-600","hover:bg-blue-700","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline","w-full"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4","bg-gray-50","p-4","rounded"],["for","empresa",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","empresa","type","text","formControlName","empresa","placeholder","Raz\xF3n Social",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],["class","text-red-500 text-xs italic",4,"ngIf"],["for","nit",1,"block","text-gray-700","text-sm","font-bold","mb-2"],["id","nit","type","text","formControlName","nit","placeholder","Ej: 900.123.456-7",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline"],[1,"text-red-500","text-xs","italic"],[1,"text-gray-400","font-normal","text-xs"],[1,"text-xl","font-semibold","mb-4","mt-8","text-gray-700","border-b","pb-2","flex","justify-between","items-center"],["type","button",1,"bg-green-500","hover:bg-green-700","text-white","font-bold","py-1","px-3","rounded","text-sm",3,"click"],["class","mb-6",4,"ngIf"],["class","bg-gray-100 p-4 rounded-lg mb-6 border border-gray-300",3,"formGroup",4,"ngIf"],[1,"mb-6"],[1,"border","border-gray-200","rounded-md","divide-y","divide-gray-200"],["class","pl-3 pr-4 py-3 flex items-center justify-between text-sm",4,"ngFor","ngForOf"],[1,"pl-3","pr-4","py-3","flex","items-center","justify-between","text-sm"],[1,"w-0","flex-1","flex","flex-col"],[1,"font-medium","text-gray-900"],[1,"text-gray-500"],[1,"ml-4","flex-shrink-0"],["type","button",1,"font-medium","text-red-600","hover:text-red-500",3,"click"],[1,"bg-gray-100","p-4","rounded-lg","mb-6","border","border-gray-300",3,"formGroup"],[1,"text-lg","font-medium","mb-3"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-4"],[1,"col-span-1"],[1,"block","text-gray-700","text-xs","font-bold","mb-1"],["formControlName","tipoTransaccion",1,"shadow","border","rounded","w-full","py-2","px-3","text-gray-700"],["value","Venta"],["value","Alquiler"],["value","Ambos"],[1,"col-span-2"],["type","text","formControlName","nombreEdificio",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","text","formControlName","direccion",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","text","formControlName","ciudad",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","text","formControlName","departamento",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","number","formControlName","precio",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["formControlName","descripcion","rows","3",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-4"],["type","number","formControlName","area",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","number","formControlName","habitaciones",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","number","formControlName","banos",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","number","formControlName","garajes",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],[1,"grid","grid-cols-2","gap-4","mb-4"],["type","number","formControlName","lat",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],["type","number","formControlName","lon",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700"],[1,"flex","justify-end"],["type","button",1,"bg-blue-600","hover:bg-blue-800","text-white","font-bold","py-2","px-4","rounded","focus:outline-none","focus:shadow-outline",3,"click"]],template:function(t,l){if(t&1&&(r(0,"div",0)(1,"h2",1),n(2),e(),r(3,"form",2),g("ngSubmit",function(){return l.submitOnboarding()}),r(4,"h3",3),n(5,"Datos del Cliente"),e(),r(6,"div",4)(7,"label",5),n(8,"Tipo de Persona"),e(),r(9,"div",6)(10,"label",7),d(11,"input",8),r(12,"span",9),n(13,"Persona Natural"),e()(),r(14,"label",7),d(15,"input",10),r(16,"span",9),n(17,"Empresa"),e()()()(),u(18,Z,11,2,"div",11),r(19,"div",12)(20,"div")(21,"label",13),n(22,"Nombre Completo (Contacto)"),e(),d(23,"input",14),e(),r(24,"div")(25,"label",15),n(26,"Correo Electr\xF3nico"),e(),d(27,"input",16),e(),r(28,"div")(29,"label",17),n(30,"Tel\xE9fono"),e(),d(31,"input",18),e(),r(32,"div")(33,"label",19),n(34,"WhatsApp"),e(),d(35,"input",20),e(),r(36,"div")(37,"label",21),n(38,"Contrase\xF1a "),u(39,ee,2,0,"span",22),e(),d(40,"input",23),e()(),u(41,oe,8,3,"ng-container",24),r(42,"div",25)(43,"button",26),n(44),e()()()()),t&2){let s;m(2),h(l.isEditMode?"Editar Usuario":"Registro de Cliente y Propiedades"),m(),p("formGroup",l.onboardingForm),m(15),p("ngIf",((s=l.onboardingForm.get("tipoPersona"))==null?null:s.value)==="EMPRESA"),m(21),p("ngIf",l.isEditMode),m(2),p("ngIf",!l.isEditMode),m(3),v(" ",l.isEditMode?"Actualizar Usuario":"Registrar Cliente y Propiedades"," ")}},dependencies:[T,V,A,H,G,W,B,k,R,z,j,D,M,L,U,I],encapsulation:2})};export{K as ClientOnboardingComponent};
